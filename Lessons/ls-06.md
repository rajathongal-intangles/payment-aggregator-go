# Lesson 6: Node.js gRPC Client

> **Progress**: `[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘]` 60%  
> **Time**: ~15 minutes

---

## ğŸ¯ Learning Objectives

- Set up Node.js/TypeScript project
- Load proto files dynamically
- Create gRPC client
- Subscribe to streaming RPC
- Process payments one at a time

---

## 1. What We're Building

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      THIS LESSON                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Go Server (:50051)              Node.js Client                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ StreamPayments  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Subscribe       â”‚            â”‚
â”‚  â”‚                 â”‚   gRPC      â”‚                 â”‚            â”‚
â”‚  â”‚  [pay_001] â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ log(pay_001)    â”‚            â”‚
â”‚  â”‚  [pay_002] â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ log(pay_002)    â”‚            â”‚
â”‚  â”‚  [pay_003] â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ log(pay_003)    â”‚            â”‚
â”‚  â”‚       ...       â”‚             â”‚      ...        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  Each payment pushed immediately, processed one at a time       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Project Structure

```
node-service/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .env
â”œâ”€â”€ proto/
â”‚   â””â”€â”€ payment.proto      # Symlink or copy from ../proto
â””â”€â”€ src/
    â”œâ”€â”€ index.ts           # Entry point
    â”œâ”€â”€ client.ts          # gRPC client wrapper
    â”œâ”€â”€ config.ts          # Environment config
    â””â”€â”€ logger.ts          # Payment logger/processor
```

---

## 3. Initialize Project

```bash
# Create directory
mkdir -p node-service
cd node-service

# Initialize npm
npm init -y

# Install dependencies
npm install @grpc/grpc-js @grpc/proto-loader dotenv

# Install dev dependencies
npm install -D typescript ts-node @types/node nodemon

# Initialize TypeScript
npx tsc --init
```

---

## 4. Configuration Files

### package.json

```json
{
  "name": "payment-grpc-client",
  "version": "1.0.0",
  "description": "gRPC client for payment processing",
  "main": "dist/index.js",
  "scripts": {
    "dev": "nodemon --exec ts-node src/index.ts",
    "start": "ts-node src/index.ts",
    "build": "tsc",
    "prod": "node dist/index.js"
  },
  "dependencies": {
    "@grpc/grpc-js": "^1.9.0",
    "@grpc/proto-loader": "^0.7.0",
    "dotenv": "^16.3.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "typescript": "^5.0.0",
    "ts-node": "^10.9.0",
    "nodemon": "^3.0.0"
  }
}
```

### tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

### .env

```env
# gRPC Server
GRPC_SERVER_HOST=localhost
GRPC_SERVER_PORT=50051

# Logging
LOG_LEVEL=info
```

---

## 5. Source Files

### src/config.ts

```typescript
import dotenv from 'dotenv';
import path from 'path';

dotenv.config();

export const config = {
  grpc: {
    host: process.env.GRPC_SERVER_HOST || 'localhost',
    port: process.env.GRPC_SERVER_PORT || '50051',
    get address() {
      return `${this.host}:${this.port}`;
    },
  },
  proto: {
    path: path.join(__dirname, '../proto/payment.proto'),
  },
  logLevel: process.env.LOG_LEVEL || 'info',
};
```

### src/logger.ts

```typescript
/**
 * Payment Logger - Processes payments one at a time
 */

export interface Payment {
  id: string;
  provider: string;
  amount: number;
  currency: string;
  status: string;
  customerEmail: string;
  createdAt: string;
  processedAt: string;
  metadata: Record<string, string>;
}

export interface PaymentEvent {
  payment: Payment;
  eventType: string;
}

// Provider enum mapping
const PROVIDERS: Record<number, string> = {
  0: 'UNKNOWN',
  1: 'STRIPE',
  2: 'RAZORPAY',
  3: 'PAYPAL',
};

// Status enum mapping
const STATUSES: Record<number, string> = {
  0: 'UNKNOWN',
  1: 'PENDING',
  2: 'COMPLETED',
  3: 'FAILED',
  4: 'REFUNDED',
};

// Format currency
function formatAmount(amount: number, currency: string): string {
  const symbols: Record<string, string> = {
    USD: '$',
    EUR: 'â‚¬',
    GBP: 'Â£',
    INR: 'â‚¹',
  };
  const symbol = symbols[currency] || currency + ' ';
  return `${symbol}${amount.toFixed(2)}`;
}

// Process a single payment
export function processPayment(event: PaymentEvent): void {
  const { payment, eventType } = event;
  
  const provider = PROVIDERS[payment.provider as unknown as number] || payment.provider;
  const status = STATUSES[payment.status as unknown as number] || payment.status;
  const amount = formatAmount(payment.amount, payment.currency);
  
  const timestamp = new Date().toISOString();
  const tag = eventType === 'new' ? 'ğŸ†• NEW' : 'ğŸ“¦ EXISTING';
  
  console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ${tag} PAYMENT                                              
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ID:        ${payment.id}
â”‚ Provider:  ${provider}
â”‚ Amount:    ${amount} ${payment.currency}
â”‚ Status:    ${status}
â”‚ Customer:  ${payment.customerEmail}
â”‚ Time:      ${timestamp}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜`);

  // Here you could add additional processing:
  // - Save to database
  // - Send notifications
  // - Update analytics
  // - Forward to another service
}

// Simple one-line log format
export function logPaymentSimple(event: PaymentEvent): void {
  const { payment, eventType } = event;
  const provider = PROVIDERS[payment.provider as unknown as number] || payment.provider;
  const status = STATUSES[payment.status as unknown as number] || payment.status;
  
  const icon = eventType === 'new' ? 'ğŸ†•' : 'ğŸ“¦';
  
  console.log(
    `${icon} [${new Date().toISOString()}] ${payment.id} | ${provider} | ${formatAmount(payment.amount, payment.currency)} ${payment.currency} | ${status}`
  );
}
```

### src/client.ts

```typescript
import * as grpc from '@grpc/grpc-js';
import * as protoLoader from '@grpc/proto-loader';
import path from 'path';
import { config } from './config';
import { PaymentEvent } from './logger';

// Proto loader options
const PROTO_OPTIONS: protoLoader.Options = {
  keepCase: false,      // Convert to camelCase
  longs: String,        // Convert int64 to string
  enums: Number,        // Keep enums as numbers
  defaults: true,       // Include default values
  oneofs: true,
};

// Load proto definition
const packageDefinition = protoLoader.loadSync(
  config.proto.path,
  PROTO_OPTIONS
);

const protoDescriptor = grpc.loadPackageDefinition(packageDefinition) as any;
const PaymentService = protoDescriptor.payment.PaymentService;

export class PaymentClient {
  private client: any;
  private connected: boolean = false;

  constructor() {
    this.client = new PaymentService(
      config.grpc.address,
      grpc.credentials.createInsecure()
    );
  }

  /**
   * Wait for the client to be ready
   */
  async connect(timeoutMs: number = 5000): Promise<void> {
    return new Promise((resolve, reject) => {
      const deadline = Date.now() + timeoutMs;
      
      this.client.waitForReady(deadline, (err: Error | undefined) => {
        if (err) {
          reject(new Error(`Failed to connect to gRPC server: ${err.message}`));
        } else {
          this.connected = true;
          console.log(`âœ… Connected to gRPC server at ${config.grpc.address}`);
          resolve();
        }
      });
    });
  }

  /**
   * Get a single payment by ID
   */
  async getPayment(paymentId: string): Promise<any> {
    return new Promise((resolve, reject) => {
      this.client.getPayment({ paymentId }, (err: Error, response: any) => {
        if (err) {
          reject(err);
        } else {
          resolve(response);
        }
      });
    });
  }

  /**
   * List payments with optional filters
   */
  async listPayments(options: {
    provider?: number;
    status?: number;
    limit?: number;
  } = {}): Promise<any> {
    return new Promise((resolve, reject) => {
      this.client.listPayments(
        {
          provider: options.provider || 0,
          status: options.status || 0,
          limit: options.limit || 10,
        },
        (err: Error, response: any) => {
          if (err) {
            reject(err);
          } else {
            resolve(response);
          }
        }
      );
    });
  }

  /**
   * Subscribe to payment stream - receives payments ONE AT A TIME
   */
  streamPayments(
    onPayment: (event: PaymentEvent) => void,
    onError?: (err: Error) => void,
    onEnd?: () => void,
    options: { provider?: number } = {}
  ): grpc.ClientReadableStream<PaymentEvent> {
    
    const stream = this.client.streamPayments({
      provider: options.provider || 0,
      status: 0,
      limit: 0,
    });

    stream.on('data', (event: PaymentEvent) => {
      onPayment(event);
    });

    stream.on('error', (err: Error) => {
      if (onError) {
        onError(err);
      } else {
        console.error('âŒ Stream error:', err.message);
      }
    });

    stream.on('end', () => {
      if (onEnd) {
        onEnd();
      } else {
        console.log('ğŸ“ª Stream ended');
      }
    });

    return stream;
  }

  /**
   * Close the client connection
   */
  close(): void {
    this.client.close();
    this.connected = false;
    console.log('ğŸ‘‹ Disconnected from gRPC server');
  }
}
```

### src/index.ts

```typescript
import { PaymentClient } from './client';
import { processPayment, logPaymentSimple, PaymentEvent } from './logger';
import { config } from './config';

// Track statistics
let stats = {
  existing: 0,
  new: 0,
  total: 0,
  startTime: Date.now(),
};

async function main() {
  console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           PAYMENT gRPC CLIENT (Node.js)                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Connecting to: ${config.grpc.address.padEnd(43)}â•‘
â•‘  Proto file:    ${config.proto.path.slice(-43).padEnd(43)}â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);

  const client = new PaymentClient();

  try {
    // Connect to server
    await client.connect();

    // Subscribe to payment stream
    console.log('\nğŸ“¡ Subscribing to payment stream...\n');
    console.log('â”€'.repeat(65));

    const stream = client.streamPayments(
      // On each payment (one at a time!)
      (event: PaymentEvent) => {
        stats.total++;
        
        if (event.eventType === 'new') {
          stats.new++;
        } else {
          stats.existing++;
        }

        // Use detailed or simple logging
        // processPayment(event);  // Detailed box format
        logPaymentSimple(event);   // One-line format
      },
      
      // On error
      (err: Error) => {
        console.error('\nâŒ Stream error:', err.message);
        printStats();
        process.exit(1);
      },
      
      // On stream end
      () => {
        console.log('\nğŸ“ª Stream ended by server');
        printStats();
      }
    );

    // Handle graceful shutdown
    process.on('SIGINT', () => {
      console.log('\n\nâ³ Shutting down...');
      stream.cancel();
      client.close();
      printStats();
      process.exit(0);
    });

    process.on('SIGTERM', () => {
      stream.cancel();
      client.close();
      process.exit(0);
    });

    // Keep process running
    console.log('Waiting for payments... (Ctrl+C to stop)\n');

  } catch (err) {
    console.error('âŒ Failed to start client:', err);
    process.exit(1);
  }
}

function printStats() {
  const duration = ((Date.now() - stats.startTime) / 1000).toFixed(1);
  console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SESSION STATS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Total Payments:    ${String(stats.total).padEnd(38)}â”‚
â”‚  Existing:          ${String(stats.existing).padEnd(38)}â”‚
â”‚  New:               ${String(stats.new).padEnd(38)}â”‚
â”‚  Duration:          ${(duration + 's').padEnd(38)}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜`);
}

// Run
main();
```

---

## 6. Copy Proto File

The Node.js client needs access to the same proto file:

```bash
# From node-service directory
mkdir -p proto
cp ../proto/payment.proto proto/
```

Or create a symlink:

```bash
ln -s ../../proto/payment.proto proto/payment.proto
```

---

## 7. Complete File Tree

```
node-service/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .env
â”œâ”€â”€ proto/
â”‚   â””â”€â”€ payment.proto      # Same as Go service
â””â”€â”€ src/
    â”œâ”€â”€ index.ts           # Entry point + streaming
    â”œâ”€â”€ client.ts          # gRPC client wrapper
    â”œâ”€â”€ config.ts          # Environment config
    â””â”€â”€ logger.ts          # Payment processor
```

---

## 8. Running the Client

### Step 1: Install dependencies

```bash
cd node-service
npm install
```

### Step 2: Copy proto file

```bash
mkdir -p proto
cp ../proto/payment.proto proto/
```

### Step 3: Start Node.js client

```bash
npm run dev
```

### Expected Output

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           PAYMENT gRPC CLIENT (Node.js)                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Connecting to: localhost:50051                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Connected to gRPC server at localhost:50051

ğŸ“¡ Subscribing to payment stream...

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“¦ [2024-01-15T10:30:00.000Z] pay_001 | STRIPE | $99.99 USD | COMPLETED
ğŸ“¦ [2024-01-15T10:30:00.001Z] pay_002 | RAZORPAY | â‚¹1500.00 INR | PENDING
ğŸ“¦ [2024-01-15T10:30:00.002Z] pay_003 | PAYPAL | â‚¬250.00 EUR | COMPLETED

Waiting for payments... (Ctrl+C to stop)

ğŸ†• [2024-01-15T10:30:05.000Z] pay_abc123 | STRIPE | $50.00 USD | COMPLETED
ğŸ†• [2024-01-15T10:30:06.000Z] pay_def456 | RAZORPAY | â‚¹2000.00 INR | PENDING
```

---

## 9. Full Test Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FULL TEST FLOW                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Terminal 1: Go Server                                          â”‚
â”‚  $ cd go-service && go run cmd/server/main.go                   â”‚
â”‚                                                                 â”‚
â”‚  Terminal 2: Node.js Client                                     â”‚
â”‚  $ cd node-service && npm run dev                               â”‚
â”‚                                                                 â”‚
â”‚  Terminal 3: Go Producer                                        â”‚
â”‚  $ cd go-service && go run cmd/producer/main.go -count=5        â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  Watch Terminal 2 - each payment appears ONE AT A TIME:         â”‚
â”‚                                                                 â”‚
â”‚  ğŸ†• pay_xxx1 | STRIPE | $45.00 USD | COMPLETED                  â”‚
â”‚  ğŸ†• pay_xxx2 | RAZORPAY | â‚¹1200.00 INR | PENDING                â”‚
â”‚  ğŸ†• pay_xxx3 | PAYPAL | â‚¬80.00 EUR | COMPLETED                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. Understanding the Flow

```
1. Node.js calls StreamPayments()
   â”‚
   â–¼
2. Go server adds Node.js to subscribers list
   â”‚
   â–¼
3. Go server sends existing payments immediately
   â”‚
   â–¼
4. Node.js logs each existing payment
   â”‚
   â–¼
5. Go server waits for new payments from Kafka
   â”‚
   â–¼
6. Kafka message arrives â†’ AddPayment() â†’ broadcast()
   â”‚
   â–¼
7. Node.js receives ONE payment via stream
   â”‚
   â–¼
8. Node.js logs it â†’ waits for next
   â”‚
   â–¼
   (repeat 6-8 for each new payment)
```

---

## 11. Quick Reference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NODE.JS gRPC CHEAT SHEET                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LOAD PROTO                                                      â”‚
â”‚   const def = protoLoader.loadSync('file.proto', options);      â”‚
â”‚   const proto = grpc.loadPackageDefinition(def);                â”‚
â”‚   const Client = proto.package.ServiceName;                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CREATE CLIENT                                                   â”‚
â”‚   const client = new Client(                                    â”‚
â”‚     'localhost:50051',                                          â”‚
â”‚     grpc.credentials.createInsecure()                           â”‚
â”‚   );                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UNARY CALL                                                      â”‚
â”‚   client.methodName(request, (err, response) => { });           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SERVER STREAMING                                                â”‚
â”‚   const stream = client.streamMethod(request);                  â”‚
â”‚   stream.on('data', (item) => { });                             â”‚
â”‚   stream.on('error', (err) => { });                             â”‚
â”‚   stream.on('end', () => { });                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CANCEL STREAM                                                   â”‚
â”‚   stream.cancel();                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Common questions:**
- "How do I handle reconnection if server restarts?"
- "Can I filter by provider in the stream?"
- "How do I add authentication?"