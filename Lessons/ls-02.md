# Lesson 2: Go Setup & Basics

> **Progress**: `[â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]` 20%  
> **Time**: ~15 minutes

---

## ğŸ¯ Learning Objectives

- Verify Go installation
- Understand Go modules
- Learn key concepts: structs, interfaces, errors, goroutines
- Write your first Go program

---

## 1. Verify Your Go Installation

```bash
# Check Go version
go version
# Expected: go version go1.21+ ...

# Check Go environment
go env GOPATH
go env GOROOT
```

**Important paths:**
```
GOROOT  â†’ Where Go is installed (don't touch)
GOPATH  â†’ Your workspace (usually ~/go)
GOPATH/bin â†’ Where installed tools go (needs to be in PATH)
```

---

## 2. Go Modules 101

Go modules = Go's dependency management (like npm for Node.js)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      go.mod                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  module github.com/yourname/payment-aggregator          â”‚  â† Module path
â”‚                                                         â”‚
â”‚  go 1.21                                                â”‚  â† Go version
â”‚                                                         â”‚
â”‚  require (                                              â”‚
â”‚      google.golang.org/grpc v1.60.0                     â”‚  â† Dependencies
â”‚      github.com/confluentinc/confluent-kafka-go v2.3.0  â”‚
â”‚  )                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Commands

```bash
# Initialize a new module
go mod init github.com/yourname/project-name

# Add a dependency (auto-adds to go.mod)
go get google.golang.org/grpc

# Download all dependencies
go mod download

# Clean up unused dependencies
go mod tidy

# See dependency tree
go mod graph
```

---

## 3. Go Project Structure

```
go-service/
â”œâ”€â”€ go.mod                 # Module definition
â”œâ”€â”€ go.sum                 # Dependency checksums (auto-generated)
â”œâ”€â”€ cmd/                   # Entry points (main packages)
â”‚   â”œâ”€â”€ producer/
â”‚   â”‚   â””â”€â”€ main.go        # go run cmd/producer/main.go
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go        # go run cmd/server/main.go
â”œâ”€â”€ internal/              # Private packages (can't be imported externally)
â”‚   â”œâ”€â”€ kafka/
â”‚   â”œâ”€â”€ grpc/
â”‚   â””â”€â”€ normalizer/
â”œâ”€â”€ pkg/                   # Public packages (can be imported)
â””â”€â”€ pb/                    # Generated protobuf code
```

**Why `cmd/` pattern?**
- One module, multiple executables
- Each folder in `cmd/` becomes a separate binary
- Shared code lives in `internal/` or `pkg/`

---

## 4. Key Go Concepts

### 4.1 Variables & Types

```go
// Type is after the name (opposite of C/Java)
var name string = "payment"
var amount float64 = 99.99
var count int = 42

// Short declaration (most common, type inferred)
name := "payment"
amount := 99.99
count := 42

// Constants
const MaxRetries = 3
```

### 4.2 Structs (like classes, but no inheritance)

```go
// Define a struct
type Payment struct {
    ID       string
    Amount   float64
    Currency string
    Status   string
}

// Create instances
p1 := Payment{
    ID:       "pay_123",
    Amount:   50.00,
    Currency: "USD",
    Status:   "completed",
}

// Or with positional args (not recommended)
p2 := Payment{"pay_456", 100.00, "INR", "pending"}

// Access fields
fmt.Println(p1.ID)        // pay_123
fmt.Println(p1.Amount)    // 50.00
```

### 4.3 Methods (functions attached to structs)

```go
// Method on Payment struct
func (p Payment) Display() string {
    return fmt.Sprintf("%s: %.2f %s", p.ID, p.Amount, p.Currency)
}

// Pointer receiver (can modify the struct)
func (p *Payment) MarkCompleted() {
    p.Status = "completed"
}

// Usage
p := Payment{ID: "pay_123", Amount: 50.00, Currency: "USD"}
fmt.Println(p.Display())  // pay_123: 50.00 USD
p.MarkCompleted()
```

### 4.4 Interfaces (key concept for gRPC!)

```go
// Interface = contract (what methods a type must have)
type PaymentProcessor interface {
    Process(payment Payment) error
    Refund(paymentID string) error
}

// Any struct implementing these methods satisfies the interface
type StripeProcessor struct{}

func (s StripeProcessor) Process(p Payment) error {
    fmt.Println("Processing via Stripe:", p.ID)
    return nil
}

func (s StripeProcessor) Refund(id string) error {
    fmt.Println("Refunding via Stripe:", id)
    return nil
}

// Now StripeProcessor "implements" PaymentProcessor
// No explicit "implements" keyword needed!
var processor PaymentProcessor = StripeProcessor{}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  In gRPC, you'll implement interfaces like:            â”‚
â”‚                                                        â”‚
â”‚  type PaymentServiceServer interface {                 â”‚
â”‚      GetPayment(ctx, req) (*Payment, error)            â”‚
â”‚      ListPayments(ctx, req) (*PaymentList, error)      â”‚
â”‚  }                                                     â”‚
â”‚                                                        â”‚
â”‚  Your job: create a struct that implements these       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 Error Handling (no try/catch!)

```go
// Functions return errors as last return value
func divide(a, b float64) (float64, error) {
    if b == 0 {
        return 0, errors.New("division by zero")
    }
    return a / b, nil
}

// Always check errors
result, err := divide(10, 0)
if err != nil {
    fmt.Println("Error:", err)
    return
}
fmt.Println("Result:", result)
```

**The Go mantra:**
```go
// This pattern is EVERYWHERE
result, err := someFunction()
if err != nil {
    // handle error
    return err
}
// use result
```

### 4.6 Goroutines (lightweight threads)

```go
// Regular function call (blocking)
processPayment(p1)
processPayment(p2)  // waits for p1 to finish

// Goroutine (concurrent)
go processPayment(p1)
go processPayment(p2)  // starts immediately, doesn't wait

// Real example: Kafka consumer runs in background
go func() {
    for {
        msg := consumer.ReadMessage()
        handleMessage(msg)
    }
}()
```

```
Without goroutines:          With goroutines:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚                            â”‚
    â–¼                            â”œâ”€â”€â–¶ task1 â”€â”€â–¶
  task1                          â”‚
    â”‚                            â”œâ”€â”€â–¶ task2 â”€â”€â–¶
    â–¼                            â”‚
  task2                          â”œâ”€â”€â–¶ task3 â”€â”€â–¶
    â”‚                            â”‚
    â–¼                            â–¼
  task3                       (all run concurrently)
```

---

## 5. Your First Go Program

Let's create a simple payment struct that we'll expand later.

Create `go-service/cmd/hello/main.go`:

```go
package main

import (
    "fmt"
    "time"
)

// Payment represents a normalized payment
type Payment struct {
    ID        string
    Provider  string
    Amount    float64
    Currency  string
    Status    string
    CreatedAt time.Time
}

// Display returns a formatted string
func (p Payment) Display() string {
    return fmt.Sprintf("[%s] %s: %.2f %s - %s",
        p.Provider, p.ID, p.Amount, p.Currency, p.Status)
}

// Normalize converts cents to dollars
func (p *Payment) Normalize() {
    if p.Amount > 100 { // Assuming cents if > 100
        p.Amount = p.Amount / 100
    }
    // Uppercase currency
    p.Currency = fmt.Sprintf("%s", p.Currency)
}

func main() {
    // Create a payment (simulating raw Kafka data)
    payment := Payment{
        ID:        "pay_abc123",
        Provider:  "stripe",
        Amount:    5000, // cents
        Currency:  "usd",
        Status:    "succeeded",
        CreatedAt: time.Now(),
    }

    fmt.Println("Before normalization:")
    fmt.Println(payment.Display())

    // Normalize it
    payment.Normalize()
    payment.Status = "COMPLETED"
    payment.Provider = "STRIPE"

    fmt.Println("\nAfter normalization:")
    fmt.Println(payment.Display())
}
```

### Run It

```bash
cd go-service
go run cmd/hello/main.go
```

**Expected output:**
```
Before normalization:
[stripe] pay_abc123: 5000.00 usd - succeeded

After normalization:
[STRIPE] pay_abc123: 50.00 usd - COMPLETED
```

---

## 6. Quick Reference Card

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GO CHEAT SHEET                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VARIABLES                                               â”‚
â”‚   name := "value"          // short declaration         â”‚
â”‚   var name string          // explicit type             â”‚
â”‚   const X = 10             // constant                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ STRUCTS                                                 â”‚
â”‚   type Name struct { }     // define                    â”‚
â”‚   n := Name{Field: val}    // create                    â”‚
â”‚   func (n Name) Method()   // method                    â”‚
â”‚   func (n *Name) Method()  // pointer method (mutate)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INTERFACES                                              â”‚
â”‚   type Name interface {    // define contract           â”‚
â”‚       Method() error                                    â”‚
â”‚   }                                                     â”‚
â”‚   // No "implements" - implicit                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ERRORS                                                  â”‚
â”‚   result, err := fn()      // always returns error      â”‚
â”‚   if err != nil { }        // always check              â”‚
â”‚   return nil               // no error                  â”‚
â”‚   return errors.New("x")   // create error              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GOROUTINES                                              â”‚
â”‚   go functionName()        // run concurrently          â”‚
â”‚   go func() { }()          // anonymous goroutine       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MODULES                                                 â”‚
â”‚   go mod init name         // create module             â”‚
â”‚   go get package           // add dependency            â”‚
â”‚   go mod tidy              // clean up                  â”‚
â”‚   go run cmd/x/main.go     // run                       â”‚
â”‚   go build cmd/x/main.go   // compile                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---
